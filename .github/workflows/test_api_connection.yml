name: Test NBA API Connection

on:
  workflow_dispatch: # Manual trigger button in GitHub Actions UI

jobs:
  test-nba-api:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt

      - name: Test NBA API with Proxy
        env:
          PROXY_URL: ${{ secrets.PROXY_URL }}
        run: |
          echo "üîß Testing NBA API connection with proxy..."
          if [ -z "$PROXY_URL" ]; then
            echo "‚ùå ERROR: PROXY_URL secret not set!"
            echo "Go to Settings ‚Üí Secrets ‚Üí Actions ‚Üí New secret"
            echo "Name: PROXY_URL"
            echo "Value: http://username:password@proxy_ip:port"
            exit 1
          fi
          echo "‚úÖ Proxy configured"
          python scripts/update_frontend_data.py --date $(date +%Y-%m-%d)
        
      - name: Check Output Files
        run: |
          echo "Checking if output files were created..."
          if [ -f "frontend/public/data/today.json" ]; then
            echo "‚úÖ today.json created"
            head -20 frontend/public/data/today.json
          else
            echo "‚ùå today.json not found"
          fi
          
          if [ -f "frontend/public/data/lastweek.json" ]; then
            echo "‚úÖ lastweek.json created"
          else
            echo "‚ùå lastweek.json not found"
          fi
